<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AKS Upgrade Helper</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="icon" type="image/png" href="logo.png">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">
                <img src="logo.png" alt="AKS Upgrade Helper Logo" height="40">
                AKS Upgrade Helper
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="#overview">Overview</a></li>
                    <li class="nav-item"><a class="nav-link" href="#features">Features</a></li>
                    <li class="nav-item"><a class="nav-link" href="#installation">Installation</a></li>
                    <li class="nav-item"><a class="nav-link" href="#usage">Usage</a></li>
                    <li class="nav-item"><a class="nav-link" href="#checks">Checks</a></li>
                    <li class="nav-item"><a class="nav-link" href="#contributing">Contributing</a></li>
                    <li class="nav-item"><a class="nav-link" href="https://github.com/yourusername/aks-upgrade-helper">GitHub</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <header class="hero">
        <div class="container text-center">
            <img src="logo.png" alt="AKS Upgrade Helper Logo" class="hero-logo mb-4">
            <h1>AKS Upgrade Helper</h1>
            <p class="lead">A comprehensive tool for validating and preparing Azure Kubernetes Service (AKS) clusters for version upgrades and node OS image updates</p>
            <div class="mt-4">
                <a href="#installation" class="btn btn-primary btn-lg me-2">Get Started</a>
                <a href="https://github.com/boliu83/aks-upgrade-helper" class="btn btn-outline-light btn-lg">View on GitHub</a>
            </div>
        </div>
    </header>

    <main class="container my-5">
        <section id="overview" class="py-5">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <h2 class="text-center mb-4">Overview</h2>
                    <p>The AKS Upgrade Helper automates pre-upgrade validation checks to ensure your AKS clusters are ready for Kubernetes version upgrades or node OS image updates. It helps identify potential issues that could cause upgrade failures by running a series of checks on your cluster configuration.</p>
                </div>
            </div>
        </section>

        <section id="features" class="py-5 bg-light">
            <div class="container">
                <h2 class="text-center mb-5">Key Features</h2>
                <div class="row g-4">
                    <div class="col-md-6 col-lg-3">
                        <div class="card h-100">
                            <div class="card-body text-center">
                                <div class="feature-icon mb-3">
                                    <i class="bi bi-check-circle-fill"></i>
                                </div>
                                <h5 class="card-title">Pre-upgrade Validation</h5>
                                <p class="card-text">Comprehensive checks to identify potential issues before upgrading</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <div class="card h-100">
                            <div class="card-body text-center">
                                <div class="feature-icon mb-3">
                                    <i class="bi bi-box-seam"></i>
                                </div>
                                <h5 class="card-title">Kubernetes & OS Updates</h5>
                                <p class="card-text">Support for both Kubernetes version upgrades and node OS image updates</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <div class="card h-100">
                            <div class="card-body text-center">
                                <div class="feature-icon mb-3">
                                    <i class="bi bi-puzzle-fill"></i>
                                </div>
                                <h5 class="card-title">Extensible Architecture</h5>
                                <p class="card-text">Easily add custom checks to suit your specific cluster requirements</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3">
                        <div class="card h-100">
                            <div class="card-body text-center">
                                <div class="feature-icon mb-3">
                                    <i class="bi bi-file-text-fill"></i>
                                </div>
                                <h5 class="card-title">Detailed Reporting</h5>
                                <p class="card-text">Clear pass/fail/warning indicators with actionable guidance</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="installation" class="py-5">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <h2 class="text-center mb-4">Installation</h2>
                    <div class="card">
                        <div class="card-body">
                            <h5>Prerequisites</h5>
                            <ul>
                                <li>Azure CLI installed and configured</li>
                                <li>User logged into Azure with appropriate permissions to:
                                    <ul>
                                        <li>View AKS cluster properties</li>
                                        <li>Execute AKS commands (using <code>az aks command invoke</code>)</li>
                                        <li>List VMSS/VMAS details</li>
                                    </ul>
                                </li>
                            </ul>
                            
                            <h5 class="mt-4">Steps</h5>
                            <ol>
                                <li>Clone the repository:
                                    <pre><code>git clone https://github.com/yourusername/aks-upgrade-helper.git
cd aks-upgrade-helper</code></pre>
                                </li>
                                <li>Make the scripts executable:
                                    <pre><code>chmod +x aks-upgrade-helper.sh</code></pre>
                                </li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="usage" class="py-5 bg-light">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <h2 class="text-center mb-4">Usage</h2>
                    
                    <h5>Basic Usage</h5>
                    <pre><code>./aks-upgrade-helper.sh --resource-id &lt;cluster-resource-id&gt; [--target-version &lt;version&gt; | --node-os-upgrade]</code></pre>
                    
                    <h5 class="mt-4">Command Line Options</h5>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Option</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>-r, --resource-id</code></td>
                                    <td>Resource ID of the AKS cluster (required)</td>
                                </tr>
                                <tr>
                                    <td><code>-t, --target-version</code></td>
                                    <td>Target Kubernetes version for upgrade (optional)</td>
                                </tr>
                                <tr>
                                    <td><code>-n, --node-os-upgrade</code></td>
                                    <td>Upgrade node OS image on all nodepools (optional)</td>
                                </tr>
                                <tr>
                                    <td><code>-s, --stage</code></td>
                                    <td>"precheck" (default) or "postcheck"</td>
                                </tr>
                                <tr>
                                    <td><code>-y, --yes</code></td>
                                    <td>Skip confirmation prompts (not implemented yet)</td>
                                </tr>
                                <tr>
                                    <td><code>-l, --log-file</code></td>
                                    <td>Custom log file path</td>
                                </tr>
                                <tr>
                                    <td><code>-V, --verbose</code></td>
                                    <td>Enable verbose output</td>
                                </tr>
                                <tr>
                                    <td><code>-h, --help</code></td>
                                    <td>Display help message</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <h5 class="mt-4">Examples</h5>
                    <p>Run pre-upgrade checks for a Kubernetes version upgrade:</p>
                    <pre><code>./aks-upgrade-helper.sh \
  --resource-id /subscriptions/{sub-id}/resourceGroups/{rg-name}/providers/Microsoft.ContainerService/managedClusters/{cluster-name} \
  --target-version 1.31.0</code></pre>
                    
                    <p>Run pre-upgrade checks for a node OS image upgrade:</p>
                    <pre><code>./aks-upgrade-helper.sh \
  --resource-id /subscriptions/{sub-id}/resourceGroups/{rg-name}/providers/Microsoft.ContainerService/managedClusters/{cluster-name} \
  --node-os-upgrade</code></pre>
                </div>
            </div>
        </section>

        <section id="checks" class="py-5">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <h2 class="text-center mb-4">Check System</h2>
                    <p>The script uses a modular check system where each validation is performed by a separate script in the <code>checks/</code> directory. Each check script is automatically discovered and executed by the main script.</p>
                    
                    <h5 class="mt-4">How Checks Work</h5>
                    <p>Each check script in the <code>checks</code> directory follows a simple pattern:</p>
                    <ol>
                        <li>It must define a <code>run_check()</code> function that performs the validation</li>
                        <li>The function should return:
                            <ul>
                                <li><code>0</code> for success (check passed ✅)</li>
                                <li><code>1</code> for failure (check failed ❌, upgrade should not proceed)</li>
                                <li><code>2</code> for warning (potential issue ⚠️, but upgrade can proceed)</li>
                            </ul>
                        </li>
                    </ol>
                    <p>The main script handles loading all checks, running them, and displaying the results.</p>
                    
                    <h5 class="mt-4">Adding Custom Checks</h5>
                    <p>You can easily extend the tool by adding new check scripts to the <code>checks</code> directory:</p>
                    <ol>
                        <li>Create a new Bash script in the <code>checks</code> directory</li>
                        <li>Define a <code>run_check()</code> function in your script</li>
                        <li>Return the appropriate status code based on check results</li>
                    </ol>
                    
                    <h5 class="mt-4">Example: Creating a Custom Check</h5>
                    <p>Here's a simple example of a check that throws a warning if the cluster's outbound type is loadBalancer:</p>
                    <pre><code>function run_check() {
    log_info "Checking outbound type for AKS cluster ${CLUSTER_NAME} in resource group ${CLUSTER_RESOURCE_GROUP}"
    outbound_type=$(echo $CLUSTER_JSON | jq -r '.properties.networkProfile.outboundType')

    if [[ $outbound_type == "loadBalancer" ]]; then
        log_error "Outbound type is loadBalancer. Exception required before upgrade. Please see &lt;insert_link&gt; for more details."
        return 2 # Warning status for outboundType loadBalancer. we don't want to block the upgrade, but we need to warn the user.
    else
        return 0
    fi
}</code></pre>
                </div>
            </div>
        </section>

        <section id="contributing" class="py-5 bg-light">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <h2 class="text-center mb-4">Contributing</h2>
                    <p>Contributions are welcome! Please feel free to submit a Pull Request with new checks or improvements.</p>
                    
                    <h5 class="mt-4">Project Structure</h5>
                    <pre><code>aks-upgrade-helper/
├── aks-upgrade-helper.sh     # Main script
├── common.sh                 # Common functions and utilities
├── README.md                 # Documentation
├── logo.png                  # Project logo
├── actions/                  # Action scripts for upgrade operations
│   └── monitor_upgrade.sh    # Script to monitor upgrade progress
├── checks/                   # Pre-upgrade validation checks
│   ├── available_ip.sh       # Check for available IPs in subnet
│   ├── check_pdb.sh          # Validate PodDisruptionBudgets
│   ├── lb_sku.sh             # Check load balancer SKU type
│   ├── msi_on_vmas.sh        # Check for MSI on VMAS clusters
│   ├── nginx_ingress_version.sh  # Validate NGINX ingress compatibility
│   ├── number_of_tags.sh     # Check for resource tag limits
│   ├── outbound_connectivity.sh  # Validate outbound connectivity
│   ├── outbound_type.sh      # Check outbound type configuration
│   └── target_version.sh     # Validate target version compatibility
└── s/                        # Staging directory for outputs</code></pre>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer bg-dark text-white py-4">
        <div class="container text-center">
            <p>AKS Upgrade Helper | Licensed under the MIT License</p>
            <p>© 2025 AKS Upgrade Helper Contributors</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"></script>
    <script src="js/scripts.js"></script>
</body>
</html>
